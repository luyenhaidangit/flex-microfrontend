<div class="container-fluid">
	<app-page-title title="{{ CONFIG.breadcrumb.title }}" [breadcrumbItems]="CONFIG.breadcrumb.items"></app-page-title>

	<div class="bg-white rounded shadow-sm p-3">

		<!-- Tabset -->
		<app-tabs 
			[tabs]="CONFIG.tabs.items" 
			[activeId]="activeTabId" 
			(activeIdChange)="onTabChange($event)">
		</app-tabs>

		<!-- Search -->
		<div class="row gx-3 mb-3 gy-2 align-items-end">
			<div class="col-md-3">
				<label class="form-label fw-bold text-muted">Từ khóa</label>
				<input class="form-control" type="text" placeholder="Nhập từ khóa..." [(ngModel)]="state.filter.keyword">
			</div>
		
			<!-- Display only in approved tab -->
			<div class="col-md-3" *ngIf="activeTabId === 'approved'">
				<label class="form-label fw-bold text-muted">Chi nhánh</label>
				<select class="form-select" [(ngModel)]="state.filter.branchId">
					<option [ngValue]="null">Tất cả</option>
					<option *ngFor="let branch of branches" [ngValue]="branch.id">
						{{ branch.name }}
					</option>
				</select>
			</div>
		
			<!-- Display only in pending tab -->
			<div class="col-md-3" *ngIf="activeTabId === 'pending'">
				<label class="form-label fw-bold text-muted">Loại yêu cầu</label>
				<select class="form-select" [(ngModel)]="state.filter.type">
					<option [ngValue]="null">Tất cả</option>
					<option [ngValue]="'CREATE'">Tạo mới</option>
					<option [ngValue]="'UPDATE'">Cập nhật</option>
					<option [ngValue]="'DELETE'">Xóa</option>
				</select>
			</div>
		
			<div class="col-md-2">
				<button class="btn btn-primary w-100" (click)="onSearch()">
					<i class="bx bx-search-alt-2"></i> Tìm kiếm
				</button>
			</div>
		
			<div class="col-md-4 text-md-end">
				<button type="button" class="btn btn-success fw-bold" (click)="openCreateModal()">
					<i class="fas fa-plus me-1"></i> Thêm mới
				</button>
			</div>
		</div>

		<div class="table-responsive">
			<table class="table align-middle table-nowrap dt-responsive nowrap w-100">
				<thead>
					<tr>
						<th *ngFor="let col of CONFIG.table.columns.approved">{{ col.label }}</th>
					</tr>
				</thead>
				<tbody *ngIf="loading">
					<tr *ngFor="let _ of [].constructor(CONFIG.table.skeleton.approved.rows)">
						<td *ngFor="let w of CONFIG.table.skeleton.approved.columns">
							<app-skeleton [width]="w" height="18px"></app-skeleton>
						</td>
					</tr>
				</tbody>
				<tbody *ngIf="!loading && items.length">
					<tr *ngFor="let u of items">
						<td class="fw-bold">{{ u.userName | safeField }}</td>
						<td>{{ u.fullName | safeField }}</td>
						<td>{{ u.email | safeField }}</td>
						<td>{{ u.branchName | safeField }}</td>
						<td>
							<app-badge [value]="u.isActive" type="status"></app-badge>
						</td>
						<td class="action-column">
							<button class="btn btn-link p-0 text-info" (click)="openDetailModal(u)" title="Xem">
								<i class="fas fa-eye"></i>
							</button>
							<button class="btn btn-link p-0 ms-2 text-warning" (click)="openEditModal(u)" title="Sửa">
								<i class="fas fa-edit"></i>
							</button>
							<button class="btn btn-link p-0 ms-2 text-danger" (click)="openDeleteModal(u)" title="Xoá">
								<i class="fas fa-trash"></i>
							</button>
						</td>
					</tr>
				</tbody>
				<tbody *ngIf="!loading && !items.length">
					<tr>
						<td [attr.colspan]="CONFIG.table.columns.approved.length" class="text-center text-muted">Không có dữ liệu</td>
					</tr>
				</tbody>
			</table>
		</div>

		<!-- Pagination -->
		<div class="table-filter d-flex justify-content-between align-items-center mt-2">
			<ul class="pagination mb-0">
				<li class="page-item cursor-pointer" [class.disabled]="state.paging.index === 1">
					<a class="page-link" (click)="onPageChange(state.paging.index - 1)">
						<i class="mdi mdi-chevron-left"></i>
					</a>
				</li>
			
				<li *ngFor="let _ of [].constructor(state.paging.totalPages); let idx = index" class="page-item cursor-pointer"
					[class.active]="state.paging.index === idx + 1">
					<a class="page-link" (click)="onPageChange(idx + 1)">
						{{ idx + 1 }}
					</a>
				</li>
			
				<li class="page-item cursor-pointer" [class.disabled]="state.paging.index === state.paging.totalPages">
					<a class="page-link" (click)="onPageChange(state.paging.index + 1)">
						<i class="mdi mdi-chevron-right"></i>
					</a>
				</li>
			</ul>
		
			<!-- page size -->
			<div class="per-page">
				Hiển thị
				<select class="mx-1 cursor-pointer" [(ngModel)]="state.paging.size" (change)="onPageSizeChange()">
					<option *ngFor="let opt of CONFIG.pagination.pageSizeOptions" [ngValue]="opt.value" class="cursor-pointer">
						{{ opt.label  }}
					</option>
				</select>
				/ {{ state.paging.totalItems }} tổng số bản ghi
			</div>
		</div>
	</div>
</div>